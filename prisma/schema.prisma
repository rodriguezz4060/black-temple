generator client {
    provider = "prisma-client-js"
    output   = "../node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("POSTGRES_URL")
}

model User {
    id Int @id @default(autoincrement())

    fullName String
    email    String   @unique
    password String
    role     UserRole @default(USER)

    provider   String?
    providerId String?

    createdAt DateTime @default(now())
    updateAt  DateTime @updatedAt
}

model ClassSelection {
    id         Int    @id @default(autoincrement())
    name       String @unique
    classIcon  String
    classColor String

    specializations ClassSpecialization[]
    guides          Guide[]
}

model ClassSpecialization {
    id                  Int    @id @default(autoincrement())
    name                String
    specIcon            String
    specBackground      String
    difficultyBarBanner String
    gearBanner          String

    class   ClassSelection @relation(fields: [classId], references: [id])
    classId Int
    guides  Guide[]

    specRole   SpecRole @relation(fields: [specRoleId], references: [id])
    specRoleId Int
}

model SpecRole {
    id       Int    @id @default(autoincrement())
    name     String @unique
    roleIcon String

    specialization ClassSpecialization[]
}

model Mode {
    id           Int    @id @default(autoincrement())
    name         String @unique
    activityBg   String
    activityIcon String

    guides Guide[]
}

model Guide {
    id    Int    @id @default(autoincrement())
    patch String

    modeRelation Mode @relation(fields: [modeId], references: [id])
    modeId       Int

    class   ClassSelection @relation(fields: [classId], references: [id])
    classId Int

    specialization   ClassSpecialization @relation(fields: [specializationId], references: [id])
    specializationId Int

    overviewDifficulty OverviewDifficulty?
    // overviewGear       OverviewGear?
    heroTalents        HeroTalents?

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([classId])
    @@index([specializationId])
    @@index([modeId])
}

model OverviewDifficulty {
    id Int @id @default(autoincrement())

    spec String
    mode String

    singleTarget  Int
    multiTarget   Int
    utility       Int
    survivability Int
    mobility      Int

    guide   Guide @relation(fields: [guideId], references: [id])
    guideId Int   @unique

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model HeroTalents {
    id Int @id @default(autoincrement())

    guide   Guide @relation(fields: [guideId], references: [id])
    guideId Int   @unique

    tabs Tab[] // Один HeroTalents имеет много Tab

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Tab {
    id Int @id @default(autoincrement())

    value   String // Уникальный идентификатор таба (например "tab1")
    label   String // Название таба (отображаемый текст)
    iconUrl String? // URL иконки (может быть null)
    content String // Markdown-контент

    // Связь с HeroTalents
    heroTalents   HeroTalents @relation(fields: [heroTalentsId], references: [id])
    heroTalentsId Int // Внешний ключ

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([value, heroTalentsId], name: "value_heroTalentsId")
    @@index([value])
}

// model OverviewGear {
//     id Int @id @default(autoincrement())

//     headImg     String?
//     headLink    String?
//     headSocket  String?
//     headEnchant String?

//     neckImg     String?
//     neckLink    String?
//     neckSocket1 String?
//     neckSocket2 String?

//     shouldersImg  String?
//     shouldersLink String?

//     backImg     String?
//     backLink    String?
//     backEnchant String?

//     chestImg     String?
//     chestLink    String?
//     chestEnchant String?

//     wristImg     String?
//     wristLink    String?
//     wristSocket1 String?
//     wristEnchant String?

//     handsImg     String?
//     handsLink    String?
//     handsEnchant String?

//     waistImg     String?
//     waistLink    String?
//     waistSocket1 String?

//     legsImg     String?
//     legsLink    String?
//     legsEnchant String?

//     feetImg     String?
//     feetLink    String?
//     feetEnchant String?

//     fingerOneImg     String?
//     fingerOneLink1   String?
//     fingerOneSocket1 String?
//     fingerOneSocket2 String?
//     fingerOneSocket3 String?
//     fingerOneEnchant String?

//     fingerTwoImg     String?
//     fingerTwoLink    String?
//     fingerTwoSocket1 String?
//     fingerTwoSocket2 String?
//     fingerTwoSocket3 String?
//     fingerTwoEnchant String?

//     trinketOneImg  String?
//     trinketOneLink String?

//     trinketTwoImg  String?
//     trinketTwoLink String?

//     mainHandImg     String?
//     mainHandLink    String?
//     mainHandEnchant String?

//     offHandImg     String?
//     offHandLink    String?
//     offHandEnchant String?

//     guide   Guide @relation(fields: [guideId], references: [id])
//     guideId Int   @unique

//     createdAt DateTime @default(now())
//     updatedAt DateTime @updatedAt
// }

enum UserRole {
    USER
    ADMIN
}
